# static全局变量和普通全局变量

面试高频指数：★★★☆☆

在 C++ 面试中，这是考察「变量作用域、链接属性、生命周期」核心概念的高频题，核心差异集中在 **链接属性** 和 **作用域**，生命周期二者一致（程序运行期全程存在）。

## 一、核心区别总结（面试必背）

| 特性          | 普通全局变量（全局变量）                                                 | static 全局变量（静态全局变量）                            |
| ----------- | ------------------------------------------------------------ | ---------------------------------------------- |
| **链接属性**    | 外部链接（external linkage）                                       | 内部链接（internal linkage）                         |
| **作用域**     | 整个程序（所有源文件可见，需声明 extern）                                     | 当前源文件（.cpp），跨文件不可见                             |
| **重定义风险**   | 高：多文件定义同名变量会导致链接错误                                           | 低：同名变量在不同文件互不干扰（独立实体）                          |
| **声明/定义方式** | 定义：`int g_val = 10;`（.cpp）<br>声明：`extern int g_val;`（其他.cpp） | 定义+声明：`static int g_static_val = 20;`（仅当前.cpp） |
| **存储位置**    | 全局数据区（静态存储区）                                                 | 全局数据区（静态存储区）                                   |
| **生命周期**    | 程序启动时初始化，程序结束时销毁                                             | 程序启动时初始化，程序结束时销毁                               |

## 二、关键概念拆解（面试加分点）

1. **链接属性（核心差异）**：  
   
   - 普通全局变量：外部链接意味着其名称会被编译器导出（extern）到目标文件（.o/.obj），其他源文件可通过 `extern` 声明引用该变量。  
   - static 全局变量：内部链接意味着其名称仅在当前源文件可见，编译器不会导出到目标文件，其他源文件无法引用，即使同名也视为独立变量。

2. **作用域与生命周期**：  
   
   - 作用域：普通全局变量是「程序级作用域」，static 全局变量是「文件级作用域」。  
   - 生命周期：二者均属于「静态存储期」，区别于局部变量（栈上存储，函数结束销毁），全局数据区的变量会在 `main` 函数执行前初始化（零初始化+显式初始化），程序退出后由操作系统回收。

3. **使用场景**：  
   
   - 普通全局变量：需跨多个源文件共享的数据（如配置参数、全局状态），但需避免重定义（通常在 .h 头文件声明 `extern`，在 .cpp 定义）。  
   - static 全局变量：仅当前文件使用的数据（如文件内部工具函数的辅助状态），避免全局命名污染和重定义错误。

## 三、测试代码（验证核心差异）

[test_global](../../../../src/test_global/)

## static 局部变量

### 普通局部变量 vs static 局部变量（对比表）

| 特性      | 普通局部变量        | static 局部变量  |
| ------- | ------------- | ------------ |
| 存储位置    | 栈区            | 全局静态区        |
| 生命周期    | 函数调用期间        | 整个程序运行期间     |
| 初始化时机   | 函数调用时         | 程序启动时（仅1次）   |
| 未显式初始化时 | 随机值（栈区垃圾值）    | 零初始化（0/NULL） |
| 作用域     | 当前函数          | 当前函数         |
| 值持久性    | 函数返回后丢失（非记忆性） | 函数返回后保留（记忆性） |

## 测试代码（验证存储位置与特性）

[test_local](../../../../src/test_local/)

## static修饰成员变量

在类中，静态成员可以实现多个对象之间的数据共享，并且使用静态数据成员还不会破坏隐藏的原则，即保证了安全性。因此，静态成员是类的所有对象中共享的成员，而不是某个对象的成员，即**属于类的**。对多个对象来说，静态数据成员只存储一处，供所有对象共用。
